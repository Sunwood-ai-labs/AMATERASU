<div align="center">

![Base Infrastructure](./assets/header.svg)

# ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£

AMATERASUã®åŸºç›¤ã¨ãªã‚‹AWSã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£æ§‹æˆ

</div>

## ğŸŒŸ æ¦‚è¦

ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã€AMATERASUãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®åŸºç›¤ã¨ãªã‚‹AWSã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’æä¾›ã—ã¾ã™ã€‚VPCã€ã‚µãƒ–ãƒãƒƒãƒˆã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã€Route53ãªã©ã®åŸºæœ¬çš„ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚½ãƒ¼ã‚¹ã‚’ç®¡ç†ã—ã¾ã™ã€‚

## ğŸ“¦ ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—æ§‹æˆ

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã•ã‚ŒãŸæŸ”è»Ÿãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã«ã‚ˆã‚Šã€ãã‚ç´°ã‹ãªã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’å®Ÿç¾ï¼š

1. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—** (`default.tf`)
   - åŸºæœ¬çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã®ãƒ™ãƒ¼ã‚¹
   - åˆ†å‰²ã•ã‚ŒãŸå„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’è¨±å¯
   - ã™ã¹ã¦ã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’è¨±å¯

2. **ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆSG** (`whitelist_sg.tf`)
   - ç‰¹å®šã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã®ã™ã¹ã¦ã®ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’è¨±å¯
   - CSVãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`whitelist-base-sg.csv`ï¼‰ã«ã‚ˆã‚‹æŸ”è»ŸãªIPç®¡ç†
   - å„IPã‚¨ãƒ³ãƒˆãƒªã«å¯¾ã™ã‚‹èª¬æ˜ä»˜ãã®å‹•çš„ãƒ«ãƒ¼ãƒ«ç”Ÿæˆ

3. **CloudFront SG** (`cloudfront_sg.tf`)
   - CloudFrontã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶å¾¡
   - HTTP(80)ãŠã‚ˆã³HTTPS(443)ãƒãƒ¼ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯
   - AWSãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãƒªã‚¹ãƒˆã‚’ä½¿ç”¨ã—ãŸåŠ¹ç‡çš„ãªç®¡ç†

4. **VPCå†…éƒ¨SG** (`vpc_internal_sg.tf`)
   - VPCå†…éƒ¨ã®é€šä¿¡ã‚’åŒ…æ‹¬çš„ã«åˆ¶å¾¡
   - ã™ã¹ã¦ã®ãƒãƒ¼ãƒˆã§VPC CIDRç¯„å›²ï¼ˆ10.0.0.0/16ï¼‰ã‹ã‚‰ã®é€šä¿¡ã‚’è¨±å¯
   - ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹é–“ã®å®‰å…¨ãªé€šä¿¡ã‚’ç¢ºä¿

### ğŸŒ Route53 DNSè¨­å®š

1. **ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³**
   - ãƒ¡ã‚¤ãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ³: `sunwood-ai-labs.com`
   - ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ç”¨

2. **ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³**
   - å†…éƒ¨ãƒ‰ãƒ¡ã‚¤ãƒ³: `sunwood-ai-labs-internal.com`
   - VPCå†…éƒ¨ã§ã®åå‰è§£æ±º
   - EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹é–“ã®é€šä¿¡ã«ä½¿ç”¨

## ğŸ› ï¸ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

1. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
```bash
# terraform.tfvarsã‚’ç·¨é›†
cp terraform.example.tfvars terraform.tfvars
```

2. å¿…è¦ãªCSVãƒ•ã‚¡ã‚¤ãƒ«ã®æº–å‚™
```bash
# ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆIPã®è¨­å®š
cp whitelist-base-sg.example.csv whitelist-base-sg.csv
```

3. Terraformã®å®Ÿè¡Œ
```bash
# åˆæœŸåŒ–
terraform init

# é©ç”¨ã¨å‡ºåŠ›ã®ä¿å­˜
terraform apply -auto-approve && terraform output -json > output.json
```

## âš™ï¸ è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

ä¸»è¦ãªè¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆ`terraform.tfvars`ï¼‰ï¼š

```hcl
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
project_name = "amts-base-infrastructure"
environment  = "dev"

# ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®š
domain_name = "sunwood-ai-labs.com"
domain_internal = "sunwood-ai-labs-internal.com"

# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š
vpc_cidr             = "10.0.0.0/16"
public_subnet_cidrs  = ["10.0.1.0/24", "10.0.2.0/24"]
private_subnet_cidrs = ["10.0.3.0/24", "10.0.4.0/24"]
```

## ğŸ” å‹•ä½œç¢ºèª

1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®ç¢ºèª
```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆSGã®ãƒ«ãƒ¼ãƒ«ç¢ºèª
aws ec2 describe-security-group-rules --filter Name="group-id",Values="<default-sg-id>"
```

2. Route53ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ç¢ºèª
```bash
# ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ä¸€è¦§
aws route53 list-resource-record-sets --hosted-zone-id <private-zone-id>
```

å„ãƒªã‚½ãƒ¼ã‚¹ã®IDã¯`output.json`ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚

## ğŸ“ æ³¨æ„äº‹é …

1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®æ›´æ–°
   - æ—¢å­˜ã®ä¾å­˜é–¢ä¿‚ã«æ³¨æ„
   - æ›´æ–°å‰ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’æ¨å¥¨

2. Route53è¨­å®šã®å¤‰æ›´
   - DNSã®ä¼æ’­æ™‚é–“ã‚’è€ƒæ…®
   - æ—¢å­˜ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã¸ã®å½±éŸ¿ã‚’ç¢ºèª

è©³ç´°ãªè¨­å®šã‚„è¿½åŠ ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã«ã¤ã„ã¦ã¯ã€å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®READMEã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
